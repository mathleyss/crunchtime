{% extends 'base.html.twig' %}

{% block title %}Ma watchlist - CrunchTime{% endblock %}

{% block menu_class %}menuOther{% endblock %}

{% block body %}
    <main>
        <section class="watchlist" role="region" aria-label="Section de la watchlist">
            <div class="watchlistTop">
                <h2>Ma watchlist</h2>
                {% if mediaList is empty %}
                <p class="erreurWatchlist" role="alert">Vous n'avez actuellement aucun film dans votre watchlist.</p>
                {% else %}
            </div>

            <div class="carousel-container" role="list" aria-label="Liste des médias">
                <div class="carousel">
                    {% for media in mediaList %}
                        {% set title = media.title ?? media.name %}
                        {% set date = media.release_date ?? media.first_air_date %}

                        <div class="movie-card" role="listitem" aria-label="Carte média" id="media_{{ media.media_type }}_{{ media.id }}">
                            <div class="movie-poster">
                                <a href="{{ path('app_media_details', {id: media.id, type: media.media_type}) }}" aria-label="Voir les détails de {{ title }}">
                                    {% if media.poster_path %}
                                        <img src="https://image.tmdb.org/t/p/w500{{ media.poster_path }}" alt="Affiche de {{ title }}">
                                    {% else %}
                                        <img src="{{ asset('images/placeholder_movie.png') }}" class="placeholder-poster" alt="Placeholder">
                                    {% endif %}
                                </a>

                                {# Bouton Plus d'infos #}
                                <button class="btn-more-info" aria-label="Plus d'options">
                                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                                </button>

                                {# Popup #}
                                <div class="card-popup hidden">
                                    <a href="{{ path('app_media_details', {id: media.id, type: media.media_type}) }}" class="popup-link">Plus de détails</a>
                                    <div class="popup-watchlist-action">
                                        <form action="{{ path('watchlist_toggle', {type: media.media_type, id: media.id, context: 'watchlist'}) }}" method="post">
                                            <button type="submit" class="btn-popup-watchlist remove">Retirer de la watchlist</button>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <div class="media-title-container">
                                <div class="media-type-icon inline" aria-hidden="true">
                                    {% if media.media_type == 'movie' %}
                                        {# SVG Film #}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" title="Film"><path d="M0 96C0 60.7 28.7 32 64 32H448c35.3 0 64 28.7 64 64V416c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V96zM48 368v32c0 8.8 7.2 16 16 16H96c8.8 0 16-7.2 16-16V368c0-8.8-7.2-16-16-16H64c-8.8 0-16 7.2-16 16zm368-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V368c0-8.8-7.2-16-16-16H416zM48 240v32c0 8.8 7.2 16 16 16H96c8.8 0 16-7.2 16-16V240c0-8.8-7.2-16-16-16H64c-8.8 0-16 7.2-16 16zm368-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V240c0-8.8-7.2-16-16-16H416zM48 112v32c0 8.8 7.2 16 16 16H96c8.8 0 16-7.2 16-16V112c0-8.8-7.2-16-16-16H64c-8.8 0-16 7.2-16 16zm368-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V112c0-8.8-7.2-16-16-16H416z"/></svg>
                                    {% else %}
                                        {# SVG TV #}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" title="Série"><path d="M64 64V352H576V64H64zM0 64C0 28.7 28.7 0 64 0H576c35.3 0 64 28.7 64 64V352c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zM128 448H512c17.7 0 32 14.3 32 32s-14.3 32-32 32H128c-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>
                                    {% endif %}
                                </div>
                                <h4>{{ title }}</h4>
                            </div>

                            <p>{{ date|date('Y') }}</p>
                            <p class="added-date">Ajouté le {{ media.added_at|date('d/m/Y') }}</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </section>
    </main>
{% endblock %}
